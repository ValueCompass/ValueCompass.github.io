/* empty css             *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                     *//* empty css               *//* empty css                  */import{G as U}from"./CulturalValueAnnotationApi-19w4jWGT.js";import{_ as $,r as w,o as j,J as l,a as E,c as A,f as m,i as c,w as g,as as C,A as B,G as L,l as b,t as R,H as J}from"./index-qyrL5qNo.js";import"./axios-CI2xUj1E.js";import"./axios-DTyqpfTh.js";const q={class:"main-container",style:{position:"relative"}},H={style:{position:"absolute",right:"0em",top:"2em",display:"flex",gap:"10px"}},I=["onClick"],V={class:"bth-container",style:{"margin-bottom":"4em"}},F={__name:"TaskHistory",setup(M){const r=JSON.parse(sessionStorage.getItem("userDetail")||"{}"),S=e=>{console.log(e);const t=e.index;console.log("要传的question信息",e),sessionStorage.setItem("editCurrentQuestion",JSON.stringify(e)),C.push({path:"/CulturalValueAnnotation/"+t})},y=w([]),v=()=>{C.push({path:"/CulturalValueAnnotation"})};w([]);const p=w(null);j(()=>{U({username:r.username,country:r.country,language:r.language}).then(e=>{console.log(e.data),p.value=e.data.annotations;const t=Object.entries(e.data.annotations).map(([o,n])=>({id:o,...n,timestamp:n.timestamp?k(n.timestamp):""}));if(t.length===0){l.warning("No task history found.");return}else y.value=t,console.log("tableData.value",y.value)}).catch(e=>{l.error(e.message)}).finally(()=>{})});function k(e){const t=new Date(e),o=new Date(t.getTime()+8*60*60*1e3),n=o.getUTCFullYear(),u=String(o.getUTCMonth()+1).padStart(2,"0"),i=String(o.getUTCDate()).padStart(2,"0"),s=String(o.getUTCHours()).padStart(2,"0"),_=String(o.getUTCMinutes()).padStart(2,"0"),f=String(o.getUTCSeconds()).padStart(2,"0");return`${n}-${u}-${i} ${s}:${_}:${f}`}const T=()=>{if(!p.value){l.warning("No data to download");return}const e=JSON.stringify(p.value,null,2),t=new Blob([e],{type:"application/json"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o;const i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),s=r.username||"anonymous",_=r.language||"unknown";n.download=`task-history-${s}-${_}-${i}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o),l.success("Download successful")},D=()=>{if(!p.value){l.warning("No data to download");return}const e=Object.entries(p.value).map(([h,d])=>({index:h,...d,timestamp:d.timestamp?k(d.timestamp):""}));if(e.length===0){l.warning("No data to download");return}const t=["index","topic_1","topic_2","principles","task_1","task_2","question_action","question","importance","frequency","raw_question","raw_importance","raw_frequency","original_response","original_highlight_cues","original_key_concepts","original_response_person","original_highlight_cues_person","original_key_concepts_person","response","highlight_cues","key_concepts","cues_actions","concepts_actions","response_person","highlight_cues_person","key_concepts_person","cues_actions_person","concepts_actions_person","timestamp"];let o=t.join(",")+`
`;e.forEach(h=>{const d=t.map(O=>{let a=h[O];return a==null?"":((Array.isArray(a)||typeof a=="object"&&a!==null)&&(a=JSON.stringify(a)),a=String(a),(a.includes(",")||a.includes('"')||a.includes(`
`))&&(a='"'+a.replace(/"/g,'""')+'"'),a)});o+=d.join(",")+`
`});const n="\uFEFF",u=new Blob([n+o],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(u),s=document.createElement("a");s.href=i;const f=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),x=r.username||"anonymous",N=r.language||"unknown";s.download=`task-history-${x}-${N}-${f}.csv`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),l.success("Download successful")};return(e,t)=>{const o=B,n=J,u=L;return E(),A("div",q,[m("div",null,[t[2]||(t[2]=m("h2",{style:{"margin-top":"2em","font-size":"1.5em",color:"#0b70c3"}}," Task History ",-1)),m("div",H,[c(o,{color:"#0B70C3",onClick:T},{default:g(()=>[...t[0]||(t[0]=[b("Download JSON",-1)])]),_:1}),c(o,{color:"#0B70C3",onClick:D},{default:g(()=>[...t[1]||(t[1]=[b("Download Excel",-1)])]),_:1})])]),c(u,{data:y.value,border:"",style:{width:"100%","margin-top":"2em"}},{default:g(()=>[c(n,{type:"index",width:"150",label:"Number"}),c(n,{prop:"question",label:"Question"},{default:g(i=>[m("span",{class:"question-link",onClick:s=>S(i.row)},R(i.row.question),9,I)]),_:1}),c(n,{prop:"timestamp",label:"Timestamp",width:"200"})]),_:1},8,["data"]),m("div",V,[c(o,{type:"primary",color:"#0B70C3",onClick:v},{default:g(()=>[...t[3]||(t[3]=[b("Create a new one",-1)])]),_:1})])])}}},nt=$(F,[["__scopeId","data-v-6c3517a8"]]);export{nt as default};
